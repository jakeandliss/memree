<div id="titles">
	<div class="row wrapper">
		<div class="medium-3 columns">
			<div class="user_info">
				<div class="avatar">
					<%= image_tag @user.avatar.url(:avatar) %>
					<%#= image_tag current_user.gravatar_url %>
				</div>
				<p><%= current_user.full_name  %></p>
			</div>
			<div class="user_journals">
				<div class="tag_list">
					<div id="journal_titles">
						<ul>
							<li class="<%= 'active' if current_page?(titles_path) %>"><%= link_to 'All Journals', titles_path %></li>
						 		<% @tags.each do |t| %>
						 			<li class="<%= 'active' if current_page?(tag_path(t.name)) %>"><%= link_to t.name, tag_path(t.name) %></li>
								<% end %>
						</ul>
					</div>
				</div>
			</div>

		</div>
		<div class="medium-9 columns">
			<div class="form clearfix" id="title_form">
				<%= render 'form' %>
			</div>
			<% @titles.each do |t| %>
				<div id="title">
					<div id="<%= dom_id(t) %>">
						<div class="header">
							<h3><%= link_to t.title, title_entries_path(t) %></h3>
							<p><%= t.title_date %></p>
						</div>
						<div class="content clearfix">
							<% t.entries.limit(4).each do |e| %>
									<div class="title_entry", >
										<div id="wrapper">
											<% e.images.limit(1).each do |i| %>
											<%= image_tag i.avatar.url(:medium) %>
										<% end %>		
										</div>
											<p style="padding:0 5px;"><%=h truncate(e.entry, :length => 85) %></p>
										</div>
							<% end %>
						</div>
						<div class="footer">
							<span style="float:right;"><%= link_to 'Delete', title_path(t), method: :delete, data: {confirm: 'Are you sure?' } %></span>
							<h5>MemryBooks: <%= raw tag_links(t.all_tags) %></h5>
						</div>
					</div>
				</div>
			<% end %>
		</div>
	</div>
</div>
<script type="text/javascript">
  $(function(){
    //$("input#title_all_tags").tagsinput('items')
  	$('#title_all_tags').tagsinput({
			typeahead: {                  
			    source: function(query) {
			      return $.get('<%= tag_list_titles_url %>'+'?text='+query);
			    }
		  
			  }

    });

     $(function () {
    $("#entry-image").change(function () {
        if (typeof (FileReader) != "undefined") {
            var dvPreview = $("#files");
            dvPreview.html("");
            var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.jpg|.jpeg|.gif|.png|.bmp)$/;
            $($(this)[0].files).each(function () {
                var file = $(this);
                if (regex.test(file[0].name.toLowerCase())) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                    	console.log(e.target.result)
                        var img = $('<tr><td><img src='+e.target.result+' style="height:100px; width:100px;"/></td><td>'+ file[0].name.toLowerCase() +'</td></tr>');

                        dvPreview.append(img);
                    }
                    reader.readAsDataURL(file[0]);
                } else {
                    alert(file[0].name + " is not a valid image file.");
                    dvPreview.html("");
                    return false;
                }
            });
        } else {
            alert("This browser does not support HTML5 FileReader.");
        }
    });
});

  });  

</script>